(function(n){jQuery.fn.html5_upload=function(t){function i(n){return n.name||n.fileName}function r(n){return n.size||n.fileSize}function f(){function o(h){var c,v;if(h==e){f.triggerHandler("html5_upload.onFinish",[e]);t.setStatus(t.genStatus(1,!0));f.attr("disabled",!1);t.autoclear&&f.val("");return}if(c=s[h],!f.triggerHandler("html5_upload.onStartOne",[i(c),h,e]))return o(h+1);if(t.setStatus(t.genStatus(0)),t.setName(t.genName(i(c),h,e)),t.setProgress(t.genProgress(0,r(c))),u.upload.onprogress=function(n){f.triggerHandler("html5_upload.onProgress",[n.loaded/n.total,i(c),h,e]);t.setStatus(t.genStatus(n.loaded/n.total));t.setProgress(t.genProgress(n.loaded,n.total))},u.onload=function(n){u.status!=200?(f.triggerHandler("html5_upload.onError",[i(c),n]),t.stopOnFirstError||o(h+1)):(f.triggerHandler("html5_upload.onFinishOne",[u.responseText,i(c),h,e]),t.setStatus(t.genStatus(1,!0)),t.setProgress(t.genProgress(r(c),r(c))),o(h+1))},u.onabort=function(){f[0].html5_upload.continue_after_abort?o(h+1):(f.attr("disabled",!1),t.autoclear&&f.val(""))},u.onerror=function(n){f.triggerHandler("html5_upload.onError",[i(c),n]);t.stopOnFirstError||o(h+1)},u.open(t.method,typeof t.url=="function"?t.url(h):t.url,!0),n.each(t.headers,function(n,t){if(t=typeof t=="function"?t(c):t,t===!1)return!0;u.setRequestHeader(n,t)}),t.sendBoundary)if(window.FormData)v=new FormData,v.append(typeof t.fieldName=="function"?t.fieldName():t.fieldName,c),n.each(t.extraFields,function(n,t){v.append(n,t)}),u.send(v);else if(c.getAsBinary){var y="------multipartformboundary"+(new Date).getTime(),p="--",a="\r\n",l="";l+=p;l+=y;l+=a;l+='Content-Disposition: form-data; name="'+(typeof t.fieldName=="function"?t.fieldName():t.fieldName)+'"';fileName=unescape(encodeURIComponent(i(c)));l+='; filename="'+fileName+'"';l+=a;l+="Content-Type: "+c.type;l+=a;l+=a;l+=c.getAsBinary();l+=a;l+=p;l+=y;l+=p;l+=a;u.setRequestHeader("content-type","multipart/form-data; boundary="+y);u.sendAsBinary(l)}else t.onBrowserIncompatible();else u.send(c)}var s=this.files,e=s.length,f=n(this),h,u;return f.triggerHandler("html5_upload.onStart",[e])?(this.disabled=!0,h=0,u=this.html5_upload.xhr,this.html5_upload.continue_after_abort=!0,o(0),!0):!1}var u=["onStart","onStartOne","onProgress","onFinishOne","onFinish","onError"],t=jQuery.extend({onStart:function(){return!0},onStartOne:function(){return!0},onProgress:function(){},onFinishOne:function(){},onFinish:function(){},onError:function(){},onBrowserIncompatible:function(){alert("Sorry, but your browser is incompatible with uploading files using HTML5 (at least, with current preferences.\n Please install the latest version of Firefox, Safari or Chrome")},autostart:!0,autoclear:!0,stopOnFirstError:!1,sendBoundary:!1,fieldName:"user_file[]",extraFields:{},method:"post",STATUSES:{STARTED:"Started",PROGRESS:"Progress",LOADED:"Loaded",FINISHED:"Finished"},headers:{"Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest","X-File-Name":function(n){return i(n)},"X-File-Size":function(n){return r(n)},"X-CSRF-Token":n('meta[name="csrf-token"]').attr("content"),"Content-Type":function(){return t.sendBoundary?!1:"multipart/form-data"}},setName:function(){},setStatus:function(){},setProgress:function(){},genName:function(n,t,i){return n+"("+(t+1)+" из "+i+")"},genStatus:function(n,i){return i?t.STATUSES.FINISHED:n==0?t.STATUSES.STARTED:n==1?t.STATUSES.LOADED:t.STATUSES.PROGRESS},genProgress:function(n,t){return n/t}},t);try{return this.each(function(){this.html5_upload={xhr:new XMLHttpRequest,continue_after_abort:!0};t.autostart&&n(this).bind("change",f);for(event in u)t[u[event]]&&n(this).bind("html5_upload."+u[event],t[u[event]]);n(this).bind("html5_upload.start",f).bind("html5_upload.cancelOne",function(){this.html5_upload.xhr.abort()}).bind("html5_upload.cancelAll",function(){this.html5_upload.continue_after_abort=!1;this.html5_upload.xhr.abort()}).bind("html5_upload.destroy",function(){this.html5_upload.continue_after_abort=!1;this.xhr.abort();delete this.html5_upload;n(this).unbind("html5_upload.*").unbind("change",f)})})}catch(e){return t.onBrowserIncompatible(),!1}}})(jQuery);
/*
//# sourceMappingURL=jQuery.html5.file.upload.min.js.map
*/