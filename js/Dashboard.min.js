function setRequestLoadTypeSwitch(n){$("#RequestLoadType .slide-switch-label").removeClass("switch-selected");$("#RequestLoadType .slide-switch-marker").removeClass("slide-switch-marker-current");switch(n){case"all":$("#RequestLoadType .slide-switch-selection").removeClass("slide-switch-right");$("#RequestLoadType .slide-switch-selection").removeClass("slide-switch-middle");$("#RequestLoadType .slide-switch-selection").addClass("slide-switch-left");$("#RequestLoadType .slide-switch-label-left span").addClass("slide-switch-marker-current");break;case"today":$("#RequestLoadType .slide-switch-selection").removeClass("slide-switch-left");$("#RequestLoadType .slide-switch-selection").removeClass("slide-switch-right");$("#RequestLoadType .slide-switch-selection").addClass("slide-switch-middle");$("#RequestLoadType .slide-switch-label-left").addClass("switch-selected");$("#RequestLoadType .slide-switch-label-middle span").addClass("slide-switch-marker-current");break;case"live":$("#RequestLoadType .slide-switch-selection").removeClass("slide-switch-middle");$("#RequestLoadType .slide-switch-selection").removeClass("slide-switch-left");$("#RequestLoadType .slide-switch-selection").addClass("slide-switch-right");$("#RequestLoadType .slide-switch-label-left").addClass("switch-selected");$("#RequestLoadType .slide-switch-label-middle").addClass("switch-selected");$("#RequestLoadType .slide-switch-label-right span").addClass("slide-switch-marker-current")}fetchType=n;getRequests(n)}function getStats(){var r=getActiveArtistID(),n,t,i;!r||r.Error||r<1||(n=iRequestStats(r),n.MessageTraffic.length!=0||n.RequestTraffic.length!=0)&&($("#mostReq").text(getSongFromID(n.HiRequestID).Title+" ("+n.HiRequest+")"),$("#leastReq").text(getSongFromID(n.LoRequestID).Title+" ("+n.LoRequest+")"),$("#mostDV").text(getSongFromID(n.HiDownVoteID).Title+" ("+n.HiDownVote+")"),$("#leastDV").text(getSongFromID(n.LoDownVoteID).Title+" ("+n.LoDownVote+")"),$("#mostUV").text(getSongFromID(n.HiUpVoteID).Title+" ("+n.HiUpVote+")"),$("#leastUV").text(getSongFromID(n.LoUpVoteID).Title+" ("+n.LoUpVote+")"),t=jlinq.from(n.RequestTraffic).max("Count"),i=jlinq.from(n.RequestTraffic).min("Count"),$("#trafficReqHi").text(formatDate(t.Date).replace("00:00","")+" ("+t.Count+")"),$("#trafficReqLo").text(formatDate(i.Date).replace("00:00","")+" ("+i.Count+")"),t=jlinq.from(n.MessageTraffic).max("Count"),i=jlinq.from(n.MessageTraffic).min("Count"),$("#trafficMsgHi").text(formatDate(t.Date).replace("00:00","")+" ("+t.Count+")"),$("#trafficMsgLo").text(formatDate(i.Date).replace("00:00","")+" ("+i.Count+")"),graph(n))}function graph(n){for(var h,i=[],f=[],r=[],e=[],t=0;t<n.RequestTraffic.length;t++)i.push(formatDate(n.RequestTraffic[t].Date).replace("00:00","")),f.push(n.RequestTraffic[t].Count);for(t=0;t<n.MessageTraffic.length;t++)r.push(formatDate(n.MessageTraffic[t].Date).replace("00:00","")),e.push(n.MessageTraffic[t].Count);var o=r.length>i.length?r:i,s={labels:o,datasets:[{label:"Request Traffic",fillColor:"transparent",strokeColor:"lime",pointColor:"rgb(255,0,255,255)",pointStrokeColor:"lime",pointHighlightFill:"lime",pointHighlightStroke:"lime",data:f},{label:"Message Traffic",fillColor:"transparent",strokeColor:"red",pointColor:"rgb(255,0,255,255)",pointStrokeColor:"red",pointHighlightFill:"red",pointHighlightStroke:"red",data:e}]},u=document.getElementById("reqchart").getContext("2d");u.canvas.width=parseInt($("#chartAccordion").css("width"))-10;u.canvas.height=400;h=new Chart(u).Line(s,{bezierCurve:!1,scaleFontColor:"white",scaleColor:"white",scaleLineColor:"white",showTooltips:!0,multiTooltipTemplate:"<%= datasetLabel %> - <%= value %>",animation:!0})}function startTimer(){pollTimer=window.setInterval(function(){resetMessageData();resetRequestData();resetStats()},1e4)}function stopTimer(){clearInterval(pollTimer)}function getRequests(n){var t=getRequestData(n);t&&!t.Error&&($("#requestAccordion").css("color","inherit"),t.length>0&&($(".mif-menu",window.parent.document).addClass("blink"),$("#requestAccordion").css("color","orange")),$("#requestList").dataTable().fnClearTable(),t.length>0&&$("#requestList").dataTable().fnAddData(t))}function getMessages(){var n=iRequestMessages(getUserID(),getActiveArtistID(),$("#messageDate").prop("checked")?1:0),t,i,e,o;if(!(n.length<1)){var f=n[0].Heading,r=formatDate(n[0].MessageDate),u="<tr><td colspan='3' class='messageDate'>"+r+"<\/td><\/tr>";for(u+="<tr><td colspan='3' class='messageHeading'><b>"+f+"<\/b><\/td><\/tr>",t=0;t<n.length;t++)i=formatDate(n[t].MessageDate),i.substring(0,i.indexOf(" "))!=r.substring(0,r.indexOf(" "))&&(r=i,u+="<tr><td colspan='3' class='messageDate'>"+r+"<\/td><\/tr>"),n[t].Heading!=f&&(f=n[t].Heading,u+="<tr><td colspan='3' class='messageHeading'><b>"+f+"<\/b><\/td><\/tr>"),e="",o=i.substring(i.indexOf(" ")),n[t].Attachment&&n[t].Attachment!=""&&(e="<a class='attachment' href='uploads/"+n[t].Attachment+"' title='Click to view attachment in a new window.' target='_new'><span class='mif-attachment'><\/span><\/a>"),n[t].Message.trim()||(n[t].Message="<i style='color:gray'>No personal message found.<\/i>"),u+="<tr class='messageData' style='width:75%!important'><td class='messageData'>"+n[t].Message+"<\/td><td class='messageAttachment'>"+e+"<\/td><td style='white-space:nowrap' style='padding-right:3px'>"+o+"<a href='#' class='messageDelete' data-messageid='"+n[t].ID+"' title='Delete message.'><span class='mif-cross'><\/span><\/a><\/td><\/tr>";$("#messageList > tbody").html(u);$("#messageCount").text(n.length)}}function formatDate(jDt){var tdate=eval("new "+jDt.replace("/","").replace("/","").substring(0,jDt.indexOf("-")-1)+")");return tdate.getMonth()+1+"/"+tdate.getDate()+"/"+tdate.getFullYear()}function resetStats(){getStats()}function resetMessageData(){var dta=getMessageData($("#messageDate").prop("checked"));$("#messageList > tbody").html("");getMessages()}function resetRequestData(n,t){var t=getRequestData(fetchType);t&&!t.Error&&($("#requestList").dataTable().fnClearTable(),t.length>0&&$("#requestList").dataTable().fnAddData(t))}function getMessageData(n){var t,i;if(n==null&&(n=!1),t=getActiveArtistID(),t&&!t.Error&&!(t<1))return i=iRequestMessages(getUserID(),t,n),i.length>0&&($(".mif-menu").addClass("blink"),max=jlinq.from(i).max("MessageCount").RequestCount,$("#messageCount").text(i.length)),i}function getRequestData(n){n==null&&(n="all");var t,i=getActiveArtistID();if(i&&!i.Error&&!(i<1))return t=n!="live"?iRequests(i,n=="today"):iRequestsLive(getActiveArtistID()),t.length>0&&($(".mif-menu").addClass("blink"),max=jlinq.from(t).max("RequestCount").RequestCount,t=jlinq.from(t).sort("RequestCount","UpVotes","DownVotes").select(),$("#requestCount").text(t.length)),t}function loadArtists(){for(var i,t=artistListByUserID(getUserID()),n=0;n<t.length;n++)i="<option value='"+t[n].ArtistID+"'>"+t[n].ArtistName+"<\/option>",$("#artistList").append(i);$("#artistList").val(getActiveArtistID())}var iRequestPoll=!1,n,fetchType="all",max=0,pollTimer;$(document).ready(function(){var i,r,t,n;loadArtists();!pollTimer&&iRequestPoll&&isPremium()&&startTimer();$("#iRequestEnable").click(function(){iRequestPoll=$(this).prop("checked");iRequestPoll===!0?(startTimer(),getRequests()):stopTimer()});$("#artistList").change(function(){var n=artistByID($("#artistList").val());setSession("activeartist",JSON.stringify(n));removeLocal("songlist");window.top.location.reload()});r=$("#requestList").dataTable({data:i,filter:!1,paging:!1,ordering:!0,info:!1,fixedHeaders:!0,language:{emptyTable:"No requests yet"},fnRowCallback:function(n,t){var i=t.UpVotes,r=t.DownVotes,u=i*1/(i+r),f=u*1/(i+r);t.RequestCount==max&&$(n).addClass("maxRequest");r>i&&$(n).addClass("redRow");i>r&&i*1/(i+r*1)>.65?$(n).addClass("greenRow"):(i>r&&i*1/(i+r*1)<=.65||i==r)&&$(n).addClass("yellowRow")},columnDefs:[{bSortable:!0,aTargets:0,mRender:function(n,t,i){return"<a class='songLink' href='#' data-songid='"+i.SongID+"' data-artist='"+escape(encodeURI(reverseArticle(i.Artist)))+"' data-title='"+i.Title+"'>"+i.Title+"<\/a>"}},{bSortable:!0,aTargets:1,mRender:function(n,t,i){return"<a class='artistLink' href='#' data-artist='"+escape(encodeURI(reverseArticle(i.Artist)))+"'>"+i.Artist+"<\/a>"}},{bSortable:!0,aTargets:2,mRender:function(n,t,i){return"<span style='font-weight:bold;font-style:italic'>"+i.RequestCount+"<\/span>"}},{bSortable:!0,aTargets:3,mRender:function(n,t,i){return i.UpVotes}},{bSortable:!0,aTargets:4,mRender:function(n,t,i){return i.DownVotes}}]});$("#RequestLoadType input").on("click",function(n){n.preventDefault();var t=$(this).val();setRequestLoadTypeSwitch(t)});$("#reqchart").css("width","1000px");isPremium()&&(getRequests(),getMessages(),getStats());setRequestLoadTypeSwitch("all");t=$(".pageHeader").height()+0;n=document.createElement("style");n.type="text/css";n.innerHTML=".hdrOffset { margin-top: "+t+"px!important; }";document.getElementsByTagName("head")[0].appendChild(n);$(".rqContent").addClass("hdrOffset")});
/*
//# sourceMappingURL=Dashboard.min.js.map
*/