"use strict";function startTimer(){pollTimer=window.setInterval(function(){resetMessageData();resetRequestData()},1e4)}function stopTimer(){clearInterval(pollTimer)}function getRequests(){var n=getRequestData($("#requestDate").prop("checked"));n&&!n.Error&&($("#requestAccordion").css("color","inherit"),n.length>0&&($(".mif-menu",window.parent.document).addClass("blink"),$("#requestAccordion").css("color","orange")),$("#requestList").dataTable().fnClearTable(),n.length>0&&$("#requestList").dataTable().fnAddData(n))}function getMessages(){var f=getActiveArtistID(),n,t,i,o,s;if(f&&!(f<1)&&(n=iRequestMessages(getUserID(f),f,$("#messageDate").prop("checked")?1:0),!n.Error&&!(n.length<1))&&!(n.length<1)){var e=n[0].Heading,r=formatDate(n[0].MessageDate),u="<tr><td colspan='3' class='messageDate'>"+r+"<\/td><\/tr>";for(u+="<tr><td colspan='3' class='messageHeading'><b>"+e+"<\/b><\/td><\/tr>",t=0;t<n.length;t++)i=formatDate(n[t].MessageDate),i.substring(0,i.indexOf(" "))!=r.substring(0,r.indexOf(" "))&&(r=i,u+="<tr><td colspan='3' class='messageDate'>"+r+"<\/td><\/tr>"),n[t].Heading!=e&&(e=n[t].Heading,u+="<tr><td colspan='3' class='messageHeading'><b>"+e+"<\/b><\/td><\/tr>"),o="",s=i.substring(i.indexOf(" ")),n[t].Attachment&&n[t].Attachment!=""&&(o="<a class='attachment' href='uploads/"+n[t].Attachment+"' title='Click to view attachment in a new window.' target='_new'><span class='mif-attachment'><\/span><\/a>"),u+="<tr class='messageData' style='width:75%!important'><td class='messageData'>"+n[t].Message+"<\/td><td class='messageAttachment'>"+o+"<\/td><td style='white-space:nowrap' style='padding-right:3px'>"+s+"<a href='#' class='messageDelete' data-messageid='"+n[t].ID+"' title='Delete message.'><span class='mif-cross'><\/span><\/a><\/td><\/tr>";$("#messageList > tbody").html(u);$("#messageCount").text(n.length)}}function formatDate(jDt){var tdate=eval("new "+jDt.replace("/","").replace("/","").substring(0,jDt.indexOf("-")-1)+")");return tdate.getMonth()+1+"/"+tdate.getDate()+"/"+tdate.getFullYear()+" "+pad(tdate.getHours())+":"+pad(tdate.getMinutes())}function resetMessageData(){var dta=getMessageData($("#messageDate").prop("checked"));$("#messageList > tbody").html("");getMessages()}function resetRequestData(n,t){var t=getRequestData($("#requestDate").prop("checked"));t&&($("#requestList").dataTable().fnClearTable(),t.length>0&&$("#requestList").dataTable().fnAddData(t))}function getMessageData(n){var i,t;if(n==null&&(n=!1),i=getActiveArtistID(),i&&!(i<1))return t=iRequestMessages(getUserID(),i,n),t.length>0&&($(".mif-menu").addClass("blink"),max=jlinq.from(t).max("MessageCount").RequestCount,$("#messageCount").text(t.length)),t}function getRequestData(n){var i,t;if(n==null&&(n=!1),i=getActiveArtistID(),i&&!(i<1))return(t=iRequests(i,n),!t||t.Error)?void 0:(t.length>0&&($(".mif-menu").addClass("blink"),max=jlinq.from(t).max("RequestCount").RequestCount,t=jlinq.from(t).sort("RequestCount","UpVotes","DownVotes").select(),$("#requestCount").text(t.length)),t)}function loadArtists(){for(var i,t=artistListByUserID(getUserID()),n=0;n<t.length;n++)i="<option value='"+t[n].ArtistID+"'>"+t[n].ArtistName+"<\/option>",$("#artistList").append(i);$("#artistList").val(getActiveArtistID())}var iRequestPoll=!1,n,max=0,pollTimer;$(document).ready(function(){var t,i,r;n=getMasterSongList().length;loadArtists();$("#SongCount").text("("+n+")");$("#iRequestLink").prop("href",iRequestURL);$("#iMessageLink").prop("href",iRequestURL);$("#clearAllMessages").data("userid",getUserID());$("#iRequestEnable").prop("checked",iRequestPoll);getLocal("dirty")?$(".mif-redo").addClass("blink"):$(".mif-redo").removeClass("blink");!pollTimer&&iRequestPoll&&isPremium()&&startTimer();iRequestPoll&&isPremium()&&(getRequests(),getMessages());$("#iRequestEnable").click(function(){iRequestPoll=$(this).prop("checked");iRequestPoll===!0?(startTimer(),getRequests()):stopTimer()});t=getSession("activeartist");t.RequestStatus?$(".warning").hide():$(".warning").show();$("#artistList").change(function(){t=artistByID($("#artistList").val());setSession("activeartist",JSON.stringify(t));removeLocal("songlist");window.top.location.reload()});$("#messageDate").change(function(){resetMessageData()});$("#requestDate").change(function(){resetRequestData()});i=getRequestData($("#requestDate").prop("checked"));r=$("#requestList").dataTable({data:i,filter:!1,paging:!1,ordering:!0,info:!1,fixedHeaders:!0,language:{emptyTable:"No requests yet"},fnRowCallback:function(n,t){var i=t.UpVotes,r=t.DownVotes,u=i*1/(i+r),f=u*1/(i+r);t.RequestCount==max&&$(n).addClass("maxRequest");r>i&&$(n).addClass("redRow");i>r&&i*1/(i+r*1)>.65?$(n).addClass("greenRow"):(i>r&&i*1/(i+r*1)<=.65||i==r)&&$(n).addClass("yellowRow")},columnDefs:[{bSortable:!0,aTargets:0,mRender:function(n,t,i){return"<a class='songLink' href='#' data-songid='"+i.SongID+"' data-artist='"+escape(encodeURI(reverseArticle(i.Artist)))+"' data-title='"+i.Title+"'>"+i.Title+"<\/a>"}},{bSortable:!0,aTargets:1,mRender:function(n,t,i){return"<a class='artistLink' href='#' data-artist='"+escape(encodeURI(reverseArticle(i.Artist)))+"'>"+i.Artist+"<\/a>"}},{bSortable:!0,aTargets:2,mRender:function(n,t,i){return"<span style='font-weight:bold;font-style:italic'>"+i.RequestCount+"<\/span>"}},{bSortable:!0,aTargets:3,mRender:function(n,t,i){return i.UpVotes}},{bSortable:!0,aTargets:4,mRender:function(n,t,i){return i.DownVotes}}]})});
/*
//# sourceMappingURL=navpanel.min.js.map
*/