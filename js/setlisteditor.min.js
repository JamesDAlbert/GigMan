"use strict";function hideColumn(n){var i=$("#sSongList").DataTable().column(n),r=$("#tableContainer").width(),u=$("#tableContainer").offsetParent().width(),t=100*r/u;i.visible()?t-=10:t+=10;$("#tableContainer").css("width",t+"%");i.visible(!i.visible());$("#tableContainer").css("width",t+"%")}function customMenu(n){var i="",t;return(n.id=="setsRoot"||n.id.indexOf("set_")==0)&&(i="set"),n.id.indexOf("subset_")==0&&(i="sub-set"),n.id.indexOf("song_")==0&&(i="song"),t={renameItem:{separator_before:!1,separator_after:!1,_class:"setlist_menu",icon:!1,label:"Rename "+i,action:function(){n.data||(n.data=n.text.toString());doRename(this,n)}},deleteItem:{separator_before:!1,separator_after:!1,_class:"setlist_menu",icon:!1,label:"Delete "+i,action:function(){doDelete(this,n)}},createItem:{separator_before:!1,separator_after:!1,_class:"setlist_menu",icon:!1,label:"Create a new "+i,action:function(){doCreate(this,n)}},saveSetlist:{separator_before:!1,separator_after:!1,_class:"setlist_menu",icon:!1,label:"Save Setlist",action:function(){saveList(n)}}},n.id=="setsRoot"?(t.deleteItem=null,t.renameItem=null,t.copyItem=null,t.saveSetlist=null):n.id.indexOf("song_")>-1||n.id.indexOf("subset_")>-1?(t.createItem=null,n.id.indexOf("song_")>-1&&(t.renameItem=null)):n.id.indexOf("song_")>-1&&(t.renameItem=null),n.id.indexOf("set_")!=0&&(t.saveSetlist=null),t}function doCreate(n,t){var i;t.id=="setsRoot"?(setCnt++,parent=t.id,i={type:"set",a_attr:{title:"Right click to add a sub-set"},id:"set_"+ ++setCnt,"class":"set",text:"New set"},$("#sets").jstree().create_node(parent,i,"last")):t.id.indexOf("set_")==0&&(ssCnt++,parent=t.id,i={type:"subset",a_attr:{title:"Drag a song from the left-hand list onto this sub-set"},id:"subset_"+ ++ssCnt,"class":"set",text:"New subset"},$("#sets").jstree().create_node(parent,i,"last"))}function saveList(n){var i=$("#sets").jstree(!0).get_json("#"+n.id,{flat:!1}),o=i.text,t,f,u,r,e;for(n.data&&setlistDelete(n.data,"",getUserID()),t=0;t<i.children.length;t++){for(f=i.children[t].text,u=[],r=0;r<i.children[t].children.length;r++)e=parseInt(i.children[t].children[r].id.substring(5)),u.push({SongID:e,Ordinal:r});setlistSave(o,f,u,getActiveArtistID())}}function doRename(n,t){$("#sets").jstree(!0).edit(t)}function doDelete(n,t){var i=getParentName(t);$("#sets").jstree(!0).delete_node(t);setlistDelete(i,t.text,getActiveArtistID())}function getParentName(n){return $("#sets").jstree(!0).get_node(n.parent).text}function doCopy(n,t){$("#sets").jstree(!0).copy_node(t)}function getAllSetlists(){for(var i,u,f=1,t=setlists(getActiveArtistID()),r=[],n=0;n<t.length;n++)i=extractSubsets(t[n],subsets(t[n],getActiveArtistID()),n),f+=i.length,u={text:t[n],a_attr:{title:"Right click to add a sub-set"},id:"set_"+(n+1),children:i,type:"set","class":"set"},r.push(u);return setCnt=t.length,{text:"<span class='root'>All Sets<\/span>",id:"setsRoot",children:r,type:"root","class":"masterRoot"}}function extractSubsets(n,t,i){for(var f,e,u=[],r=0;r<t.length;r++)f=getSongs(n,t[r]),e={text:t[r],id:"subset_"+i+"_"+r,type:"subset",attributes:{"class":"subset"},children:f},u.push(e);return ssCnt+=t.length,u}function getSongs(n,t){for(var i,e,o,u=setlist(n,t,getActiveArtistID()),f=[],s=getMasterSongList(),r=0;r<u.Songs.length;r++)i=jlinq.from(s).equals("ID",u.Songs[r].SongID).select(),i.length>0&&(i=i[0],e=i.Title+": <i class='treeArtist'>"+i.Artist+"<\/i>",o={text:e,id:"song_"+i.ID,type:"song",attributes:{"class":"song"}},f.push(o),sngCnt++);return f}var sngCnt=1,setCnt=1,ssCnt=1,sets,setLists,songs=[];$(function(){var f,n;setLists=getAllSetlists();var e=parseInt(getSession("fontSize")),t="images/note.png",i="images/list.png",r="images/check.png",u="images/library.png";getSession("colorscheme")=="highcontrast"?(t="images/note-inv.png",i="images/list-inv.png",r="images/check-inv.png",u="images/library-inv.png"):getSession("colorscheme")=="neon"&&(t="images/note-inv.png",i="images/list-inv.png",r="images/check-inv.png",u="images/library-inv.png");getSession("colorscheme")=="highcontrast"&&$("#sets").bind("loaded.jstree",function(){sets.jstree("open_all")});sets=$("#sets").jstree({core:{data:setLists,themes:{icons:!0},check_callback:!0},plugins:["dnd","types","contextmenu"],types:{"default":{icon:u,valid_children:["set"]},song:{icon:t,valid_children:["nothingatall"]},subset:{icon:r,valid_children:["song","default"]},set:{icon:i,valid_children:["subset"]}},contextmenu:{items:customMenu}});sets.bind("dblclick.jstree",function(n){var t=$(n.target).closest("li"),i=t[0].id,r,u;i.indexOf("song_")>-1&&(r=t[0].innerText.split(": ")[0],u=t[0].innerText.split(": ")[1],i=t[0].id.substring(5),window.location="lyrics.html?id="+i)});f=getMasterSongList();n=$("#sSongList").dataTable({aaData:f,bPaginate:!0,paging:!0,bDestroy:!1,sPaginationType:"simple_numbers",orderClasses:!1,sDom:"plfBt",bLengthChange:!0,responsive:!0,fixedHeader:{header:!1},offsetTop:5,oLanguage:{sEmptyTable:"There are no songs in the song list.",sSearch:""},aoColumnDefs:[{bVisible:!1,className:"songTitle",aTargets:0,mRender:function(n,t,i){return"<span class='ID'>"+i.ID+"<\/span>"},visible:!0,searchable:!0},{aTargets:1,className:"songTitle",mRender:function(n,t,i){return"<a class='songLink' data-songid='"+i.ID+"'>"+i.Title+"<\/a>"}},{aTargets:2,className:"songTitle",mRender:function(n,t,i){return"<a class='artistLink' data-artist='"+escape(encodeURI(reverseArticle(i.Artist)))+"'>"+i.Artist+"<\/a>"}},{aTargets:3,className:"songTitle",mRender:function(n,t,i){return"<a class='addRemove' data-id='"+escape(i.ID)+"'><span class='mif-arrow-right' title='Add to selected setlist.'><\/span><\/a>"}},]});$(n.fnGetNodes()).draggable({opacity:.7,helper:function(){var t=n.fnGetData(n.fnGetPosition(this)),i=t.Title,r=t.Artist,u=t.ID;return $('<span data-id="'+u+'" data-title="'+i+'" data-artist="'+r+'" style="white-space:nowrap;color:black;background-color:white"/>').text(i+" "+r)},cursorAt:{left:5,top:5},cursor:"move",connectToSortable:"#sets",start:function(){$(this).css("z-index",100)}});$(document).on("dnd_stop.vakata",function(t,i){if(i.data.jstree){var u=n.find(".selected"),r=0;if(parent=i.event.target,typeof i.data.nodes[0]=="string")return!0;$.each(u,function(n,t){if(r>0){var i=t.cells[1].innerText,u=t.cells[2].innerText,f=t.cells[0].innerText,e={type:"song",id:"song_"+f,"class":"song",text:i+": <i class='treeArtist'>"+u+"<\/i>"};$("#sets").jstree().create_node(parent,e,"last")}r++})}});$(".songTitle").on("mousedown",function(t){var i=t.target.parentElement.parentElement.cells[0].innerText,r=t.target.parentElement.parentElement.cells[1].innerText,u=n.fnGetData(n.fnGetPosition(this)[0]).ID;return $.vakata.dnd.start(t,{jstree:!0,obj:$(this),nodes:[{id:"song_"+u,text:i+": <i class='treeArtist'>"+r+"<\/i>",type:"song"}],type:"song"},'<div id="jstree-dnd" class="song"><i class="jstree-icons jstree-er"><\/i>'+i+"<\/div>")});$("#sSongList").selectable({filter:"tr",stop:function(){$(".ui-selected",this).each(function(){var n=$("#sSongList tr").index(this)-1;$("#sSongList tbody tr:eq("+n+")").toggleClass("row-selected");$("#sSongList tbody tr:eq("+n+")").toggleClass("ui-selected")})}});$("#sSongList tbody").on("click","tr",function(){$(this).toggleClass("selected")});$("#eSetList tbody").on("click","tr",function(){$(this).toggleClass("selected")});$(".dataTables_filter").css("margin","5px");$("input[type=search]").attr("placeholder","Enter Search term");$(".dataTables_filter input").css("float","right").css("margin-right","5px");$(document).on("click",".addRemove",function(){var n=$(this).data("id"),i=$("#sets [aria-labelledby*='song_"+n+"_anchor']"),r;if(i&&i.length>0){if(r=confirm("That song is already in the selected list. Add it anyway?"),r==!0){var u=$("#sSongList").dataTable().fnGetData(),t=jlinq.from(u).equals("ID",n).select()[0],f={type:"song",id:"song_"+n,"class":"song",text:t.Title+": <i class='treeArtist'>"+t.Artist+"<\/i>"};$("#sets").jstree().create_node(parent,f,"last")}}else{var u=$("#sSongList").dataTable().fnGetData(),t=jlinq.from(u).equals("ID",n).select()[0],f={type:"song",id:"song_"+n,"class":"song",text:t.Title+": <i class='treeArtist'>"+t.Artist+"<\/i>"};$("#sets").jstree().create_node(parent,f,"last")}})});
/*
//# sourceMappingURL=setlisteditor.min.js.map
*/